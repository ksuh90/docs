---
title: 'Caveats when deploying to AWS platforms'
metaTitle: 'Caveats when deploying to AWS platforms'
metaDescription: 'Known caveats when deploying to an AWS platform'
---

<TopBlock>

The following describes some caveats you might face when deploying to different AWS platforms.

</TopBlock>

## AWS Lambda + Serverless Framework + Next.js

The [Serverless Framework](https://www.serverless.com/framework/docs/) is an open source CLI that enables you to manage and deploy serverless applications.

The Serverless Framework can be used to deploy an [AWS Lambda function](https://www.serverless.com/framework/docs/providers/aws/guide/intro/) through Next.Js, you may however encounter issues with the Prisma binary not being copied over into the lambda function.

Another known issue is the Prisma query engine losing its executable flag. This is due to the `CopyWebpackPlugin` and the `aws-lambda` component used internally by the `serverless-next.js` package.

The solution is to use `WebpackPermissionsPlugin` and a community created [patched package](https://www.npmjs.com/package/serverless-nextjs-lambda-binary-fix) for the `serverless-next.js` package.

A working example of a next.config.js file and serverless.yml:

```js file=next.config.js
const CopyWebpackPlugin = require('copy-webpack-plugin')
const WebpackPermissionsPlugin = require('webpack-permissions-plugin')
const path = require('path')

module.exports = {
  target: 'serverless',

  webpack: (config, {}) => {
    config.plugins.push(
      new CopyWebpackPlugin([
        {
          from: path.join(
            __dirname,
            'node_modules/@prisma/client/runtime/query-engine-rhel-openssl-1.0.x'
          ),
          to: path.join(__dirname, '.next/serverless/pages/api/query-engine-rhel-openssl-1.0.x'),
        },
        {
          from: path.join(__dirname, 'prisma/schema.prisma'),
          to: path.join(__dirname, '.next/serverless/pages/api/'),
        },
      ])
    )
    config.plugins.push(
      new WebpackPermissionsPlugin({
        buildFiles: [
          {
            path: path.join(
              __dirname,
              '.next/serverless/pages/api/query-engine-rhel-openssl-1.0.x'
            ),
            fileMode: '755',
          },
        ],
      })
    )

    // https://github.com/webpack/webpack/issues/1599
    config.node.__dirname = false

    return config
  },
}
```

```yml file=serverless.yml
example:
  component: serverless-nextjs-lambda-binary-fix@1.11.4
```

> **Note**: An SQLite database still wont be read. For this type of deployment it is suggested to us another SQL database.

## AWS RDS Proxy

Prisma is compatible with AWS RDS Proxy. However, there is no benefit in using it for connection pooling with Prisma due to the way RDS Proxy pins connections:

> "Your connections to the proxy can enter a state known as pinning. When a connection is pinned, each later transaction uses the same underlying database connection until the session ends. Other client connections also can't reuse that database connection until the session ends. The session ends when the client connection is dropped." - <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/rds-proxy.html">AWS RDS Proxy Docs</a>

Prepared statements (of any size) or query statements greater than 16 KB cause RDS Proxy to pin the session. Because Prisma uses prepared statements for all queries, you won't see any benefit when using RDS Proxy with Prisma.

## AWS Elastic Beanstalk

AWS Elastic Beanstalk is a PaaS-like deployment service that abstracts away infrastructure and allows you to deploy applications to AWS quickly.

When deploying an app using Prisma Client to AWS Elastic Beanstalk, Prisma generates the Prisma Client code into `node_modules`. This is typically done in the `postinstall` hook.

Because Beanstalk limits the ability to write to the filesystem in the `postinstall` hook, you need to create an [`.npmrc`](https://docs.npmjs.com/cli/v6/configuring-npm/npmrc) file in the root of your project and add the following configuration:

```config file=.npmrc
unsafe-perm=true
```

Enabling `unsafe-perm` forces _npm_ to run as _root_, avoiding the filesystem access problem, thereby allowing the `prisma generate` command in the `postinstall` hook to generate code into `node_modules`.
